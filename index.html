<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanner Barcode Arsip</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f7f7f7;
    }
    #reader {
      width: 100%;
      max-width: 400px;
      margin: auto;
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
    }
    input, button {
      padding: 10px;
      margin-top: 10px;
      width: 90%;
      max-width: 300px;
    }
    button {
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #1b5e20;
    }
  </style>
</head>
<body>
  <h2>üìë Scanner Barcode Peminjaman Arsip</h2>
  <div id="reader"></div>
  
  <div class="result-box" id="resultBox" style="display:none;">
    <h3>Hasil Scan</h3>
    <p><b>Kode Arsip:</b> <span id="kodeArsip"></span></p>
    <p><b>Nama Dokumen:</b> <span id="namaDokumen"></span></p>
    <p>
      <label>Nama Peminjam:</label><br>
      <input type="text" id="namaPeminjam" placeholder="Masukkan nama peminjam">
    </p>
    <button onclick="kirimData()">üì§ Simpan ke Google Sheet</button>
  </div>

  <script>
    function onScanSuccess(decodedText) {
      // Format data: KODE|NAMA DOKUMEN
      const parts = decodedText.split("|");
      if (parts.length === 2) {
        document.getElementById("kodeArsip").innerText = parts[0];
        document.getElementById("namaDokumen").innerText = parts[1];
        document.getElementById("resultBox").style.display = "block";
      } else {
        alert("Format QR tidak sesuai! Harus: KODE|NAMA DOKUMEN");
      }
    }

    function onScanFailure(error) {
      // bisa diabaikan (scanner tetap jalan)
    }

    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 }
    );
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);

    function kirimData() {
      let kode = document.getElementById("kodeArsip").innerText;
      let dokumen = document.getElementById("namaDokumen").innerText;
      let nama = document.getElementById("namaPeminjam").value;

      if (nama === "") {
        alert("Nama peminjam harus diisi!");
        return;
      }

      // Ganti URL di bawah dengan URL Web App Google Apps Script kamu
      let url = "https://script.google.com/macros/s/AKfycbzx7XAxtp_YMJUbMLuukekR9LzPAUh3HmX04OcQLn63PD4wpfLjMqLekdzHmqw5yuuh/exec";
      
      fetch(url, {
        method: "POST",
        body: JSON.stringify({ kode: kode, dokumen: dokumen, nama: nama }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(data => {
        alert("‚úÖ Data berhasil dikirim: " + data);
      })
      .catch(err => {
        alert("‚ùå Gagal mengirim data: " + err);
      });
    }
  </script>
</body>
</html>
